"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):e(Highcharts)}(function(e){var r,t;t=function(e,r,t){if(e.regression&&!e.rendered){e.regressionSettings=e.regressionSettings||{},e.regressionSettings.tooltip=e.regressionSettings.tooltip||{},e.regressionSettings.dashStyle=e.regressionSettings.dashStyle||"solid",e.regressionSettings.decimalPlaces=e.regressionSettings.decimalPlaces||2,e.regressionSettings.useAllSeries=e.regressionSettings.useAllSeries||!1;var n,i=e.regressionSettings.type||"linear",o={data:[],color:e.regressionSettings.color||"",yAxis:e.yAxis,lineWidth:e.regressionSettings.lineWidth||2,marker:{enabled:!1},isRegressionLine:!0,visible:e.regressionSettings.visible,type:e.regressionSettings.linetype||"spline",name:e.regressionSettings.name||"Equation: %eq",id:e.regressionSettings.id,dashStyle:e.regressionSettings.dashStyle||"solid",showInLegend:!e.regressionSettings.hideInLegend,tooltip:{valueSuffix:e.regressionSettings.tooltip.valueSuffix||" "}},s=e.data;if(e.regressionSettings.useAllSeries)for(s=[],di=0;di<series.length;di++){var a=series[di];s=s.concat(a.data)}if("linear"==i)n=function(e,r){for(var t=[0,0,0,0,0],n=0,i=[],o=e.length;n<e.length;n++)null!=e[n].x&&(e[n][0]=e[n].x,e[n][1]=e[n].y),null!=e[n][1]?(t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][0]*e[n][0],t[3]+=e[n][0]*e[n][1],t[4]+=e[n][1]*e[n][1]):o-=1;for(var s=(o*t[3]-t[0]*t[1])/(o*t[2]-t[0]*t[0]),a=t[1]/o-s*t[0]/o,l=0,g=e.length;l<g;l++){var u=e[l][0]*s+a;r&&(u=parseFloat(u.toFixed(r))),i.push([e[l][0],u])}return i.sort(function(e,r){return e[0]>r[0]?1:e[0]<r[0]?-1:0}),{equation:[s,a],points:i,string:"y = "+Math.round(100*s)/100+"x + "+Math.round(100*a)/100}}(s,e.regressionSettings.decimalPlaces),o.type="line";else if("exponential"==i)n=function(e){var r=[0,0,0,0,0,0],t=0,n=[];for(l=e.length;t<l;t++)null!=e[t].x&&(e[t][0]=e[t].x,e[t][1]=e[t].y),null!=e[t][1]&&(r[0]+=e[t][0],r[1]+=e[t][1],r[2]+=e[t][0]*e[t][0]*e[t][1],r[3]+=e[t][1]*Math.log(e[t][1]),r[4]+=e[t][0]*e[t][1]*Math.log(e[t][1]),r[5]+=e[t][0]*e[t][1]);for(var i=r[1]*r[2]-r[5]*r[5],o=Math.pow(Math.E,(r[2]*r[3]-r[5]*r[4])/i),s=(r[1]*r[4]-r[5]*r[3])/i,a=0,l=e.length;a<l;a++){var g=[e[a][0],o*Math.pow(Math.E,s*e[a][0])];n.push(g)}return n.sort(function(e,r){return e[0]>r[0]?1:e[0]<r[0]?-1:0}),{equation:[o,s],points:n,string:"y = "+Math.round(100*o)/100+"e^("+Math.round(100*s)/100+"x)"}}(s);else if("polynomial"==i)n=function(e,r,t){void 0===r&&(r=2);for(var n=[],i=[],o=[],s=0,a=0,l=0,g=r+1;l<g;l++){for(var u=0,h=e.length;u<h;u++)null!=e[u].x&&(e[u][0]=e[u].x,e[u][1]=e[u].y),null!=e[u][1]&&(s+=Math.pow(e[u][0],l)*e[u][1]);n.push(s),s=0;for(var d=[],f=0;f<g;f++){for(u=0,h=e.length;u<h;u++)e[u][1]&&(a+=Math.pow(e[u][0],l+f));d.push(a),a=0}i.push(d)}i.push(n);var p=function(e,r){var t=0,n=0,i=0,o=0,s=0,a=e.length-1,l=new Array(r);for(t=0;t<a;t++){for(o=t,n=t+1;n<a;n++)Math.abs(e[t][n])>Math.abs(e[t][o])&&(o=n);for(i=t;i<a+1;i++)s=e[i][t],e[i][t]=e[i][o],e[i][o]=s;for(n=t+1;n<a;n++)for(i=a;i>=t;i--)e[i][n]-=e[i][t]*e[t][n]/e[t][t]}for(n=a-1;n>=0;n--){for(s=0,i=n+1;i<a;i++)s+=e[i][n]*l[i];l[n]=(e[a][n]-s)/e[n][n]}return l}(i,g),c=e[e.length-1][0]-e[e.length-2][0];for(l=0,h=e.length+t;l<h;l++){var v,S=0;v=void 0!==e[l]?e[l][0]:e[e.length-1][0]+(l-e.length)*c;for(var M=0;M<p.length;M++)S+=p[M]*Math.pow(v,M);o.push([v,S])}o.sort(function(e,r){return e[0]>r[0]?1:e[0]<r[0]?-1:0});var y="y = ";for(l=p.length-1;l>=0;l--)y+=l>1?Math.round(100*p[l])/100+"x^"+l+" + ":1==l?Math.round(100*p[l])/100+"x + ":Math.round(100*p[l])/100;return{equation:p,points:o,string:y}}(s,e.regressionSettings.order||2,e.regressionSettings.extrapolate||0);else if("logarithmic"==i)n=function(e){var r=[0,0,0,0],t=0,n=[];for(a=e.length;t<a;t++)null!=e[t].x&&(e[t][0]=e[t].x,e[t][1]=e[t].y),null!=e[t][1]&&(r[0]+=Math.log(e[t][0]),r[1]+=e[t][1]*Math.log(e[t][0]),r[2]+=e[t][1],r[3]+=Math.pow(Math.log(e[t][0]),2));for(var i=(t*r[1]-r[2]*r[0])/(t*r[3]-r[0]*r[0]),o=(r[2]-i*r[0])/t,s=0,a=e.length;s<a;s++){var l=[e[s][0],o+i*Math.log(e[s][0])];n.push(l)}return n.sort(function(e,r){return e[0]>r[0]?1:e[0]<r[0]?-1:0}),{equation:[o,i],points:n,string:"y = "+Math.round(100*o)/100+" + "+Math.round(100*i)/100+" ln(x)"}}(s);else{if("loess"!=i)return void console.error("Invalid regression type: ",i);n=function(e,r){r=r||.25;var t=e.map(function(e){return e[0]}),n=function(e){var r,t={},n=e.length,i=[];for(r=0;r<n;r+=1)t[e[r]]=e[r];for(r in t)i.push(t[r]);return i}(t);2/n.length>r&&(r=Math.min(2/n.length,1),console.warn("updated bandwith to "+r));var i=e.map(function(e){return e[1]});function o(e){var r=1-e*e*e;return r*r*r}var s=[],a=0,l=Math.floor(r*t.length)-1;for(var g in t){var u=t[g];g>0&&l<t.length-1&&t[l+1]-t[g]<t[g]-t[a]&&(a++,l++);for(var h=Math.abs(1/(t[t[g]-t[a]>t[l]-t[g]?a:l]-u)),d=0,f=0,p=0,c=0,v=0,S=a;S<=l;){var M=t[S],y=i[S],m=o((S<g?u-M:M-u)*h),x=M*m;d+=m,f+=x,p+=M*x,c+=y*m,v+=y*x,S++}var q,w=f/d,b=c/d,A=p/d,P=b-(q=A==w*w?0:(v/d-w*b)/(A-w*w))*w;s[g]=q*u+P}return{equation:"",points:t.map(function(e,r){return[e,s[r]]}),string:""}}(s,(e.regressionSettings.loessSmooth||25)/100)}return n.rSquared=function(e,r){e.sort(function(e,r){return e[0]>r[0]?1:e[0]<r[0]?-1:0});for(var t=0,n=e.length,i=0;i<e.length;i++)null!=e[i][1]?t+=e[i][1]:n--;t/=n;var o=0,s=0;for(i=0;i<e.length;i++)null!=e[i][1]&&(s+=Math.pow(e[i][1]-r[i][1],2),o+=Math.pow(e[i][1]-t,2));return 1-s/o}(s,n.points),n.rValue=Math.sqrt(n.rSquared).toFixed(e.regressionSettings.decimalPlaces),n.rSquared=n.rSquared.toFixed(e.regressionSettings.decimalPlaces),n.standardError=function(e,r){for(var t=0,n=e.length,i=0;i<e.length;i++)null!=e[i][1]?t+=Math.pow(e[i][1]-r[i][1],2):n--;return Math.sqrt(t/(n-2))}(s,n.points).toFixed(e.regressionSettings.decimalPlaces),o.data=n.points,o.name=o.name.replace("%r2",n.rSquared),o.name=o.name.replace("%r",n.rValue),o.name=o.name.replace("%eq",n.string),o.name=o.name.replace("%se",n.standardError),!1===o.visible&&(o.visible=!1),o.regressionOutputs=n,o}},(r=e).wrap(r.Chart.prototype,"init",function(e){var r=arguments[1].series,n=[],i=0;for(i=0;i<r.length;i++){var o=t(r[i]);n.push(o),arguments[1].series[i].rendered=!0}o&&(arguments[1].series=r.concat(n)),e.apply(this,Array.prototype.slice.call(arguments,1))}),r.wrap(r.Chart.prototype,"addSeries",function(e){var r=t(arguments[1]);arguments[1].rendered=!0,r&&this.addSeries(r),e.apply(this,Array.prototype.slice.call(arguments,1))})});